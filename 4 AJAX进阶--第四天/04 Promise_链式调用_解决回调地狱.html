<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise链式调用_解决回调地狱</title>
</head>

<body>
    <form>
        <span>省份：</span>
        <select>
            <option class="province"></option>
        </select>
        <span>城市：</span>
        <select>
            <option class="city"></option>
        </select>
        <span>地区：</span>
        <select>
            <option class="area"></option>
        </select>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        /**
         * 目标：把回调函数嵌套代码，改成Promise链式调用结构
         * 需求：获取默认第一个省，第一个市，第一个地区并展示在下拉菜单中
        */

        // 由于两个then之间的变量无法相互访问，所以要定义全局变量，中途赋值后即可使用
        let pname = ''
        // 1.得到-获取省份Promise对象
        axios({ url: 'http://hmajax.itheima.net/api/province' }).then(res1 => {
            // console.log(res1);
            pname = res1.data.list[0] // 第一个省
            document.querySelector('.province').innerHTML = pname
            // 新的province对象来自上一个then的return值
            // 2. 得到-获取城市的Promise对象
            return axios({ url: 'http://hmajax.itheima.net/api/city', params: { pname } })
        }).then(res2 => {//一定要在外部then，避免函数回调的嵌套问题
            // console.log(res2);
            const cname = res2.data.list[0] // 第一个市
            document.querySelector('.city').innerHTML = cname
            // 3. 得到-获取地区的Promise对象
            return axios({ url: 'http://hmajax.itheima.net/api/area', params: { pname, cname } })
        }).then(res3 => { //链式调用解构，上级每次返回新的Promise对象，下级的res来自上级Promise对象，最后形成新的结果
            const areaName = res3.data.list[0]
            document.querySelector('.area').innerHTML = areaName
        })
    </script>
</body>

</html>

<!--
做法：每个 Promise 对象中管理一个异步任务，用 then 返回 Promise 对象，串联起来
获取省份Promise对象 -> .then(回调函数) -> 新的Promise对象 -> .then(回调函数) -> 新的Promise对象 -> .then(回调函数)
                        return 获取城市 Promise 对象           return 获取地区 Promise 对象

 

 -->